version: 1
applications:
  - appRoot: apps/web-industry
    frontend:
      phases:
        preBuild:
          commands:
            - echo "Installing pnpm globally..."
            - npm install -g pnpm@8.15.4
            - echo "Installing all workspace dependencies..."
            - cd ../..
            - pnpm install
            - echo "Building shared packages..."
            - cd packages/contracts && pnpm run build && cd ../..
            - cd packages/utils && pnpm run build && cd ../..
            - cd packages/ui-components && pnpm run build && cd ../..
            - echo "Returning to app directory..."
            - cd apps/web-industry
        build:
          commands:
            - echo "Building web-industry app..."
            - pnpm run build
      artifacts:
        baseDirectory: .next
        files:
          - '**/*'
      cache:
        paths:
          - ../../node_modules/**/*
          - .next/cache/**/*
          - ../../packages/contracts/node_modules/**/*
          - ../../packages/utils/node_modules/**/*
          - ../../packages/ui-components/node_modules/**/*
    environment:
      variables:
        # API URLs - Ã€ configurer dans AWS Amplify Console
        NEXT_PUBLIC_API_URL: 'https://api.symphonia.com/api/v1'
        NEXT_PUBLIC_ORDERS_API_URL: 'https://api.symphonia.com/orders/api/v1'
        NEXT_PUBLIC_TRACKING_API_URL: 'https://api.symphonia.com/tracking/api/v1'
        NEXT_PUBLIC_APPOINTMENTS_API_URL: 'https://api.symphonia.com/appointments/api/v1'
        NEXT_PUBLIC_DOCUMENTS_API_URL: 'https://api.symphonia.com/documents/api/v1'
        NEXT_PUBLIC_SCORING_API_URL: 'https://api.symphonia.com/scoring/api/v1'
        NEXT_PUBLIC_AFFRET_API_URL: 'https://api.symphonia.com/affret/api/v1'
        NEXT_PUBLIC_WS_URL: 'wss://ws.symphonia.com'
        # Build configuration
        NODE_VERSION: '20'
        PNPM_VERSION: '8.15.4'
