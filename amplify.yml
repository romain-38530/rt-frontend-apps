version: 1
applications:
  - appRoot: apps/web-industry
    frontend:
      phases:
        preBuild:
          commands:
            - echo "Installing pnpm globally..."
            - npm install -g pnpm@8.15.4
            - echo "Going to repository root..."
            - cd ../..
            - echo "Installing all workspace dependencies..."
            - pnpm install
            - echo "Building all dependencies with Turbo (handles package dependencies automatically)..."
            - pnpm turbo build --filter=@rt/web-industry^...
            - echo "Returning to app directory..."
            - cd apps/web-industry
        build:
          commands:
            - echo "Building web-industry app..."
            - pnpm run build
      artifacts:
        baseDirectory: out
        files:
          - '**/*'
      cache:
        paths:
          - ../../node_modules/**/*
          - .next/cache/**/*
          - ../../.turbo/**/*
    customHeaders:
      - pattern: '**/*'
        headers:
          - key: 'Cache-Control'
            value: 'public, max-age=31536000, immutable'
      - pattern: '*.html'
        headers:
          - key: 'Cache-Control'
            value: 'public, max-age=0, must-revalidate'
    environment:
      variables:
        # API URLs - AWS Elastic Beanstalk
        NEXT_PUBLIC_API_URL: 'http://rt-authz-api-prod.eba-smipp22d.eu-central-1.elasticbeanstalk.com/api'
        NEXT_PUBLIC_ORDERS_API_URL: 'http://rt-orders-api-prod.eba-dbgatxmk.eu-central-1.elasticbeanstalk.com/api/v1'
        NEXT_PUBLIC_TRACKING_API_URL: 'http://rt-geo-tracking-api-prod.eba-3mi2pcfi.eu-central-1.elasticbeanstalk.com/api'
        NEXT_PUBLIC_APPOINTMENTS_API_URL: 'http://rt-orders-api-prod.eba-dbgatxmk.eu-central-1.elasticbeanstalk.com/api/v1'
        NEXT_PUBLIC_DOCUMENTS_API_URL: 'http://rt-orders-api-prod.eba-dbgatxmk.eu-central-1.elasticbeanstalk.com/api/v1'
        NEXT_PUBLIC_SCORING_API_URL: 'http://rt-orders-api-prod.eba-dbgatxmk.eu-central-1.elasticbeanstalk.com/api/v1'
        NEXT_PUBLIC_AFFRET_API_URL: 'http://rt-orders-api-prod.eba-dbgatxmk.eu-central-1.elasticbeanstalk.com/api/v1'
        NEXT_PUBLIC_WS_URL: 'ws://rt-orders-api-prod.eba-dbgatxmk.eu-central-1.elasticbeanstalk.com'
        # Build configuration
        NODE_VERSION: '20'
        PNPM_VERSION: '8.15.4'
