version: 1
frontend:
  phases:
    preBuild:
      commands:
        - npm install -g pnpm@8.15.4
        - cd ../..
        - pnpm install --no-frozen-lockfile
        - pnpm turbo build --filter=@rt/web-industry^...
        - cd apps/web-industry
    build:
      commands:
        - pnpm run build
  artifacts:
    baseDirectory: out
    files:
      - '**/*'
  cache:
    paths:
      - ../../node_modules/**/*
      - .next/cache/**/*
      - ../../.turbo/**/*
  customHeaders:
    - pattern: '**/*'
      headers:
        - key: 'Cache-Control'
          value: 'public, max-age=31536000, immutable'
    - pattern: '*.html'
      headers:
        - key: 'Cache-Control'
          value: 'public, max-age=0, must-revalidate'
  environment:
    variables:
      # Site Configuration
      NEXT_PUBLIC_SITE_URL: 'https://industry.symphonia-controltower.com'
      NEXT_PUBLIC_PORTAL_TYPE: 'industry'

      # Core APIs (CloudFront HTTPS) - All URLs must include /api
      NEXT_PUBLIC_API_URL: 'https://d2jgmccc3o2t9k.cloudfront.net/api'
      NEXT_PUBLIC_ORDERS_API_URL: 'https://dh9acecfz0wg0.cloudfront.net/api/v1'
      NEXT_PUBLIC_AUTHZ_URL: 'https://d2jgmccc3o2t9k.cloudfront.net/api'
      NEXT_PUBLIC_TRACKING_API_URL: 'https://d2mn43ccfvt3ub.cloudfront.net/api'
      NEXT_PUBLIC_APPOINTMENTS_API_URL: 'https://d28uezz0327lfm.cloudfront.net/api'
      NEXT_PUBLIC_DOCUMENTS_API_URL: 'https://d8987l284s9q4.cloudfront.net/api'
      NEXT_PUBLIC_SCORING_API_URL: 'https://d1uyscmpcwc65a.cloudfront.net/api'
      NEXT_PUBLIC_AFFRET_API_URL: 'https://d393yiia4ig3bw.cloudfront.net/api'
      NEXT_PUBLIC_WS_URL: 'wss://d2aodzk1jwptdr.cloudfront.net'

      # Industry-specific APIs (CloudFront HTTPS)
      NEXT_PUBLIC_PLANNING_API_URL: 'https://dpw23bg2dclr1.cloudfront.net/api'
      NEXT_PUBLIC_BILLING_API_URL: 'https://d1ciol606nbfs0.cloudfront.net/api'
      NEXT_PUBLIC_STORAGE_MARKET_API_URL: 'https://d1ea8wbaf6ws9i.cloudfront.net/api'
      NEXT_PUBLIC_CHATBOT_API_URL: 'https://de1913kh0ya48.cloudfront.net/api'

      # Build
      NODE_VERSION: '20'
      PNPM_VERSION: '8.15.4'
